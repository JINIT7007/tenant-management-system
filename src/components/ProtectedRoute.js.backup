import React from 'react';
import { Navigate } from 'react-router-dom';

function ProtectedRoute({ children, requiredRole }) {
    const token = localStorage.getItem('token');
    
    if (!token) {
        console.log('No token found, redirecting to login');
        return React.createElement(Navigate, { to: '/login', replace: true });
    }

    try {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!user || !user.role) {
            console.log('No user role found, redirecting to login');
            return React.createElement(Navigate, { to: '/login', replace: true });
        }

        if (requiredRole && user.role !== requiredRole) {
            console.log(`User role ${user.role} does not match required ${requiredRole}`);
            return React.createElement(Navigate, { to: '/login', replace: true });
        }

        console.log('Auth passed, rendering protected content');
        return children;
    } catch (error) {
        console.error('Error parsing user data:', error);
        return React.createElement(Navigate, { to: '/login', replace: true });
    }
}

export default ProtectedRoute;
